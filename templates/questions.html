{% extends "base.html" %}
{% block content %}
<div class="container stack">
  <h2>ðŸ“š Questions</h2>

  <form method="GET" class="stack section">
    <input type="text" name="q" value="{{ term }}" placeholder="Search...">
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <select name="role">
        <option value="">Role</option>
        {% for r in roles %}<option value="{{ r }}" {% if r==role %}selected{% endif %}>{{ r }}</option>{% endfor %}
      </select>
      <select name="topic">
        <option value="">Topic</option>
        {% for t in topics %}<option value="{{ t }}" {% if t==topic %}selected{% endif %}>{{ t }}</option>{% endfor %}
      </select>
      <select name="level">
        <option value="">Level</option>
        {% for lv in levels %}<option value="{{ lv }}" {% if lv==level %}selected{% endif %}>{{ lv }}</option>{% endfor %}
      </select>
      <select name="company">
        <option value="">Company</option>
        {% for c in companies %}<option value="{{ c }}" {% if c==company %}selected{% endif %}>{{ c }}</option>{% endfor %}
      </select>
      <button class="btn btn-alt">Filter</button>
    </div>
  </form>

  <section class="stack">
    {% for q in items %}
      <article class="section">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
          <div style="font-weight:800;">{{ q.title }}</div>
          <span class="muted">{{ q.level }}</span>
        </div>
        <div class="muted">Role: {{ q.role }} â€¢ Topic: {{ q.topic }} â€¢ {{ q.company }}</div>
        <p><a class="btn btn-cta" href="{{ url_for('question_detail', qid=q.id) }}">Solve â†’</a></p>
      </article>
    {% endfor %}
  </section>

  {% set args = request.args.to_dict() %}
  {% set base = request.path %}
  <div style="display:flex; gap:10px; align-items:center;">
    {% if pagination.has_prev %}
      {% set prev_qs = args.copy() %}
      {% set _ = prev_qs.update({'page': pagination.prev_num}) %}
      <a class="btn btn-browse" href="{{ base }}?{% for k, v in prev_qs.items() %}{{ k }}={{ v }}{% if not loop.last %}&{% endif %}{% endfor %}">Prev</a>
    {% endif %}
    <div>Page {{ pagination.page }} / {{ pagination.pages }}</div>
    {% if pagination.has_next %}
      {% set next_qs = args.copy() %}
      {% set _ = next_qs.update({'page': pagination.next_num}) %}
      <a class="btn btn-browse" href="{{ base }}?{% for k, v in next_qs.items() %}{{ k }}={{ v }}{% if not loop.last %}&{% endif %}{% endfor %}">Next</a>
    {% endif %}
  </div>
</div>
{% endblock %}
